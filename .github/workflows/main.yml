name: "CI Builds"
on: [push]
jobs:
  build-linux:
    strategy:
      matrix:
        dist:
          - debian.12
          - fedora.41
          - opensuse.tumbleweed
          - ubuntu.24.04
    runs-on: ubuntu-latest
    container: veyon/ci.linux.${{matrix.dist}}
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: true
      - run: .ci/linux.${{matrix.dist}}/script.sh $GITHUB_WORKSPACE /tmp

  build-windows:
    stage: build
    image: $CI_REGISTRY/veyon/ci-mingw-w64:5.0
    script:
      - .ci/windows/build.sh $ARCH
    parallel:
      matrix:
        - ARCH: [i686, x86_64]
    artifacts:
      paths: [ veyon-win* ]
      expire_in: 1 day
